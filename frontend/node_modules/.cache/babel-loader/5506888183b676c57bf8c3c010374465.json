{"ast":null,"code":"import _regeneratorRuntime from\"/Users/dewble/Workspace/go/src/gomusic/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/dewble/Workspace/go/src/gomusic/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/dewble/Workspace/go/src/gomusic/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/dewble/Workspace/go/src/gomusic/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/dewble/Workspace/go/src/gomusic/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/dewble/Workspace/go/src/gomusic/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/dewble/Workspace/go/src/gomusic/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{injectStripe,StripeProvider,Elements,CardElement}from'react-stripe-elements';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var INITIALSTATE=\"INITIAL\",SUCCESSSTATE=\"COMPLETE\",FAILEDSTATE=\"FAILED\";var CreditCardForm=/*#__PURE__*/function(_React$Component){_inherits(CreditCardForm,_React$Component);var _super=_createSuper(CreditCardForm);function CreditCardForm(props){var _this;_classCallCheck(this,CreditCardForm);_this=_super.call(this,props);_this.handleSubmit=_this.handleSubmit.bind(_assertThisInitialized(_this));_this.handleInputChange=_this.handleInputChange.bind(_assertThisInitialized(_this));_this.state={value:'',status:INITIALSTATE};return _this;}_createClass(CreditCardForm,[{key:\"renderCreditCardInformation\",value:function renderCreditCardInformation(){var style={base:{'fontSize':'20px','color':'#495057','fontFamily':'apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Arial,sans-serif'}};var usersavedcard=/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"form-row text-center\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn  btn-outline-success text-center mx-auto\",children:\"Use saved card?\"})}),/*#__PURE__*/_jsx(\"hr\",{})]});var remembercardcheck=/*#__PURE__*/_jsxs(\"div\",{className:\"form-row form-check text-center\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input\",type:\"checkbox\",value:\"\",id:\"remembercardcheck\"}),/*#__PURE__*/_jsx(\"label\",{className:\"form-check-label\",htmlFor:\"remembercardcheck\",children:\"Remember Card?\"})]});// 뷰 반환\nreturn/*#__PURE__*/_jsxs(\"div\",{children:[usersavedcard,/*#__PURE__*/_jsx(\"h5\",{className:\"mb-4\",children:\"Payment Info\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:this.handleSubmit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-lg-12 form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"cc-name\",children:\"Name On Card:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"cc-name\",name:\"cc-name\",className:\"form-control\",placeholder:\"Name on Card\",onChange:this.handleInputChange,type:\"text\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-lg-12 form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card\",children:\"Card Information:\"}),/*#__PURE__*/_jsx(CardElement,{id:\"card\",className:\"form-control\",style:style})]})}),remembercardcheck,/*#__PURE__*/_jsx(\"hr\",{className:\"mb-4\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-success btn-large\",children:this.props.operation})]})]});}},{key:\"renderSuccess\",value:function renderSuccess(){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h5\",{className:\"mb-4 text-success\",children:\"Request Successfull....\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-success btn-large\",\"data-dismiss\":\"modal\",children:\"Ok\"})]});}},{key:\"renderFailure\",value:function renderFailure(){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h5\",{className:\"mb-4 text-danger\",children:\" Credit card information invalid, try again or exit\"}),this.renderCreditCardInformation()]});}},{key:\"handleSubmit\",value:function(){var _handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var id,_yield$this$props$str,token,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();id=\"\";// 저장된 카드 사용이 아니라면 스트라이프에 토큰을 요청한다.\nif(this.state.useExisting){_context.next=12;break;}_context.next=5;return this.props.stripe.createToken({name:this.state.name});case 5:_yield$this$props$str=_context.sent;token=_yield$this$props$str.token;if(!(token==null)){_context.next=11;break;}console.log(\"invalid token\");this.setState({status:FAILEDSTATE});return _context.abrupt(\"return\");case 11:id=token.id;case 12:_context.next=14;return fetch(\"/users/charge\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({token:id,customer_id:this.props.user,product_id:this.props.productid,sell_price:this.props.price,rememberCard:this.state.remember!==undefined,useExisting:this.state.useExisting})});case 14:response=_context.sent;// 응답이 ok면 작업 성공\nif(response.ok){console.log(\"Purchase Complete!\");this.setState({status:SUCCESSSTATE});}else{this.setState({status:FAILEDSTATE});}case 16:case\"end\":return _context.stop();}}},_callee,this);}));function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}return handleSubmit;}()},{key:\"handleInputChange\",value:function handleInputChange(event){this.setState({value:event.target.value});}},{key:\"render\",value:function render(){var body=null;switch(this.state.status){case SUCCESSSTATE:body=this.renderSuccess();break;case FAILEDSTATE:body=this.renderFailure();break;default:body=this.renderCreditCardInformation();}return/*#__PURE__*/_jsx(\"div\",{children:body});}}]);return CreditCardForm;}(React.Component);export default function CreditCardInformation(props){if(!props.show){return/*#__PURE__*/_jsx(\"div\",{});}// 스트라이프 API를 사용해 CreditCardForm를 추가하면 createToken() 메서드를 호출할 수 있다.\nvar CCFormWithStripe=injectStripe(CreditCardForm);return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(StripeProvider,{apiKey:\"pk_test_51JqdjpHqNVgKzGGZFZuBvitqdRPC5iN3nwYvdinqY2n5QcfozKRxCYT3sVQVRh26opBOFXz0IvbahgPC6IL7rqWh00ADHiTRK6\",children:/*#__PURE__*/_jsx(Elements,{children:/*#__PURE__*/_jsx(CCFormWithStripe,{operation:props.operation})})})});}","map":{"version":3,"sources":["/Users/dewble/Workspace/go/src/gomusic/frontend/src/CreditCards.js"],"names":["React","injectStripe","StripeProvider","Elements","CardElement","INITIALSTATE","SUCCESSSTATE","FAILEDSTATE","CreditCardForm","props","handleSubmit","bind","handleInputChange","state","value","status","style","base","usersavedcard","remembercardcheck","operation","renderCreditCardInformation","event","preventDefault","id","useExisting","stripe","createToken","name","token","console","log","setState","fetch","method","headers","body","JSON","stringify","customer_id","user","product_id","productid","sell_price","price","rememberCard","remember","undefined","response","ok","target","renderSuccess","renderFailure","Component","CreditCardInformation","show","CCFormWithStripe"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { injectStripe, StripeProvider, Elements, CardElement } from 'react-stripe-elements';\n\nconst INITIALSTATE = \"INITIAL\", SUCCESSSTATE = \"COMPLETE\", FAILEDSTATE = \"FAILED\";\n\nclass CreditCardForm extends React.Component {\n    constructor(props) {\n        super(props);\n        this.handleSubmit = this.handleSubmit.bind(this);\n        this.handleInputChange = this.handleInputChange.bind(this);\n        this.state = {\n            value: '',\n            status: INITIALSTATE\n        };\n    }\n\n    renderCreditCardInformation() {\n        const style = {\n            base: {\n                'fontSize': '20px',\n                'color': '#495057',\n                'fontFamily': 'apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Arial,sans-serif'\n            }\n        };\n        const usersavedcard = <div>\n            <div className=\"form-row text-center\">\n                <button type=\"button\" className=\"btn  btn-outline-success text-center mx-auto\">Use saved card?</button>\n            </div>\n            <hr />\n        </div>\n\n        const remembercardcheck = <div className=\"form-row form-check text-center\">\n            <input className=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"remembercardcheck\" />\n            <label className=\"form-check-label\" htmlFor=\"remembercardcheck\">\n                Remember Card?\n            </label>\n        </div>;\n        // 뷰 반환\n        return (\n            <div>\n                {usersavedcard}\n                <h5 className=\"mb-4\">Payment Info</h5>\n                <form onSubmit={this.handleSubmit}>\n                    <div className=\"form-row\">\n                        <div className=\"col-lg-12 form-group\">\n                            <label htmlFor=\"cc-name\">Name On Card:</label>\n                            <input id=\"cc-name\" name='cc-name' className=\"form-control\" placeholder='Name on Card' onChange={this.handleInputChange} type='text' />\n                        </div>\n                    </div>\n                    <div className=\"form-row\">\n                        <div className=\"col-lg-12 form-group\">\n                            <label htmlFor=\"card\">Card Information:</label>\n                            <CardElement id=\"card\" className=\"form-control\" style={style} />\n                        </div>\n                    </div>\n                    {remembercardcheck}\n                    <hr className=\"mb-4\" />\n                    <button type=\"submit\" className=\"btn btn-success btn-large\" >{this.props.operation}</button>\n                </form>\n            </div>\n        );\n    }\n\n    renderSuccess() {\n        return (\n            <div>\n                <h5 className=\"mb-4 text-success\">Request Successfull....</h5>\n                <button type=\"submit\" className=\"btn btn-success btn-large\" data-dismiss=\"modal\">Ok</button>\n            </div>\n        );\n    }\n\n    renderFailure() {\n        return (\n            <div>\n                <h5 className=\"mb-4 text-danger\"> Credit card information invalid, try again or exit</h5>\n                {this.renderCreditCardInformation()}\n            </div>\n        );\n    }\n\n    async handleSubmit(event) {\n\n        event.preventDefault();\n        let id = \"\";\n\n        // 저장된 카드 사용이 아니라면 스트라이프에 토큰을 요청한다.\n        if (!this.state.useExisting) {\n            // Strip API를 통해 토큰 발급\n            let { token } = await this.props.stripe.createToken({ name: this.state.name });\n            if (token == null) {\n                console.log(\"invalid token\");\n                this.setState({ status: FAILEDSTATE });\n                return;\n            }\n            id = token.id;\n        }\n        \n        // 요청을 생성하고 백엔드로 보낸다.\n        let response = await fetch(\"/users/charge\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n                token: id,\n                customer_id: this.props.user,\n                product_id: this.props.productid,\n                sell_price: this.props.price,\n                rememberCard: this.state.remember !== undefined,\n                useExisting: this.state.useExisting\n            })\n        });\n\n        // 응답이 ok면 작업 성공\n        if (response.ok) {\n            console.log(\"Purchase Complete!\");\n            this.setState({ status: SUCCESSSTATE });\n        } else {\n            this.setState({ status: FAILEDSTATE });\n        }\n    }\n\n\n    handleInputChange(event) {\n        this.setState({\n            value: event.target.value\n        })\n    }\n\n    render() {\n\n        let body = null;\n        switch (this.state.status) {\n            case SUCCESSSTATE:\n                body = this.renderSuccess();\n                break;\n            case FAILEDSTATE:\n                body = this.renderFailure();\n                break;\n            default:\n                body = this.renderCreditCardInformation();\n        }\n\n        return (\n            <div>\n                {body}\n            </div>\n        );\n    }\n}\nexport default function CreditCardInformation(props) {\n    if(!props.show) {\n        return <div/>;\n    }\n    // 스트라이프 API를 사용해 CreditCardForm를 추가하면 createToken() 메서드를 호출할 수 있다.\n    const CCFormWithStripe = injectStripe(CreditCardForm);\n    return (\n        <div>\n            {/*stripe provider*/}\n            <StripeProvider apiKey=\"pk_test_51JqdjpHqNVgKzGGZFZuBvitqdRPC5iN3nwYvdinqY2n5QcfozKRxCYT3sVQVRh26opBOFXz0IvbahgPC6IL7rqWh00ADHiTRK6\">\n                <Elements>\n                    <CCFormWithStripe operation={props.operation} />\n                </Elements>\n            </StripeProvider>\n        </div>\n    );\n}\n\n"]},"metadata":{},"sourceType":"module"}